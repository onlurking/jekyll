{% comment %}
Attached to all pages, this include will check two things:

1. IF this page is known to be a translation of another page because its YAML contains an `original` tag, then the first
section of this workflow searches across the site to find the 1 matching page that is the `translation_source`

1. Are there are any translations of this page elsewhere on the site. This checks both for
a) Direct translations that have this page listed under their 'original' metadata
b) Indirect translations that share the same 'original' as this page
Those 0+ page objects are saved to the variable `translation_candidates` available when rendering the rest of the page.

If this page is a translation because it has the key `original`, then begin a search for the original page
{% endcomment %}

{% include page-slug.html %}

{% if page.original %}

{% assign target_slug = page.original %}
{% assign target_name = target_slug | append: ".md" %}

{% assign translation_sources = site.pages | where: "name", target_name %}
{% assign translation_source = translation_sources | last %}

{% else %}

{% assign target_slug = page.name | remove_first: ".md" %}
{% assign target_name = page.name %}
{% assign translation_source = page %}

{% endif %}

{% assign translation_candidates = site.pages | where: "original", target_slug %}

{% assign all_translations = translation_candidates | push: translation_source %}

{% assign n_translations = all_translations | size %}
{% if n_translations > 3 %}
<h1>too many translations</h1>
{% endif %}

<p>Target name: {{ target_name | inspect }}</p>
<p>Translation sources: {{ translation_sources | map: "name" | inspect }}</p>
<p>Chosen source: {{ translation_source.name | inspect }}</p>
<p>Translation candidates: {{ translation_candidates | map: "name" | inspect }}</p>
<p>All translations: {{ all_translations | map: "name" | inspect }}</p>
